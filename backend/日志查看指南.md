# MultiRoleChat LLM日志查看指南

## 📍 日志现在在哪里看？

### 1. 🖥️ 实时控制台查看（推荐）

**当前最直接的查看方式：**
- 在运行Flask服务的终端控制台直接查看
- 所有LLM增强日志都会实时输出到启动Flask的控制台

**如何查看：**
1. 找到正在运行Flask服务的终端窗口
2. 直接查看控制台输出，格式如下：
   ```
   [LLM-REQ-ID: LLM-1764686686051-6d5f1376] API_LAYER - 开始处理LLM请求 | user_id=test_user | session_id=test_session
   [LLM-REQ-ID: LLM-1764686686051-6d5f1376] CORE_LAYER - 调用Anthropic Claude API | model=claude-3-5-sonnet-20241022
   [LLM-REQ-ID: LLM-1764686686051-6d5f1376] CORE_LAYER - API调用成功 | response_time=2.345s | response_length=1500
   ```

### 2. 📁 日志文件查看

**日志文件位置：**
```
D:\ProjectPackage\MultiRoleChat\backend\logs\app.log
```

**注意事项：**
- 该目录现在已创建 ✅
- 需要重启Flask服务才能激活文件日志功能

### 3. 🛠️ 专业日志查看工具

**使用我们创建的日志查看器：**

#### 基本用法
```bash
cd "D:\ProjectPackage\MultiRoleChat\backend"
python log_viewer.py
```

#### 高级筛选选项
```bash
# 按请求ID筛选
python log_viewer.py --request-id "LLM-1764686686051-6d5f1376"

# 按用户ID筛选
python log_viewer.py --user-id "test_user"

# 按层级筛选（API/MANAGER/CORE）
python log_viewer.py --layer "API"

# 只看错误日志
python log_viewer.py --error-only

# 按关键词筛选
python log_viewer.py --keyword "API调用"

# 发送测试请求并查看日志
python log_viewer.py --test-api
```

## 🔍 日志格式说明

### 标准日志格式
```
[LLM-REQ-ID: {请求ID}] {层级}_LAYER - {消息} | {详细信息}
```

### 日志层级说明
- **API_LAYER**: API接口层，处理HTTP请求和响应
- **MANAGER**: 管理层，处理业务逻辑和消息转换
- **CORE**: 核心服务层，处理Anthropic API调用

### 关键信息字段
- **request_id**: 唯一请求标识符，用于追踪完整请求链路
- **user_id**: 用户标识
- **session_id**: 会话标识
- **response_time**: 响应时间
- **response_length**: 响应内容长度

## 🚀 快速测试LLM日志

### 发送测试请求
```bash
curl -X POST http://127.0.0.1:5000/api/llm/chat \
  -H "Content-Type: application/json" \
  -H "X-User-ID: test_log_viewer" \
  -H "X-Session-ID: test_session" \
  -d '{"message": "这是一个测试消息", "history": []}'
```

### 使用内置测试工具
```bash
cd "D:\ProjectPackage\MultiRoleChat\backend"
python log_viewer.py --test-api
```

## 🛠️ 故障排除

### 问题1: 看不到日志输出
**解决方案：**
1. 确认Flask服务正在运行
2. 检查是否在正确的终端窗口查看
3. 尝试重启Flask服务：
   ```bash
   cd "D:\ProjectPackage\MultiRoleChat\backend"
   python run.py
   ```

### 问题2: 日志文件不存在
**解决方案：**
1. 检查 `logs/` 目录是否存在：
   ```bash
   ls logs/
   ```
2. 如果不存在，创建目录：
   ```bash
   mkdir logs
   ```
3. 重启Flask服务以激活文件日志

### 问题3: "无法生成回复"问题诊断
**使用日志诊断步骤：**
1. 查看API层日志确认请求接收
2. 查看管理层日志确认消息转换
3. 查看核心层日志确认API调用
4. 检查错误日志找出具体失败原因

## 💡 使用建议

### 开发环境
- 使用控制台实时查看（最方便）
- 使用日志查看工具进行筛选分析

### 生产环境
- 配置日志轮转避免文件过大
- 使用日志聚合工具（如ELK Stack）
- 设置日志监控和告警

### 调试技巧
1. 使用唯一的用户ID和会话ID进行测试
2. 使用关键词筛选快速定位问题
3. 关注响应时间异常的请求
4. 重点关注错误和警告日志

---

## 📞 需要帮助？

如果在使用日志查看功能时遇到问题：
1. 检查Flask服务状态
2. 确认日志文件权限
3. 使用简单的curl命令测试
4. 查看控制台错误信息

现在你可以轻松查看和分析所有的LLM请求日志，快速定位和解决问题！🎉