# 【流程模板】修改模板功能完整数据流程分析

## 功能概述

本文档详细分析【流程模板】模块中【修改模板】按钮点击后的完整数据流程，包括前端数据加载、前后端通信协议、后端处理逻辑以及数据库更新格式。

## 1. 前端界面触发

### 1.1 修改按钮位置

**文件位置**: `fronted/src/MultiRoleDialogSystem.tsx:827`

```tsx
<button onClick={() => handleEdit(flow)} className={`${theme.text} ${theme.textHover} font-medium text-sm`}>编辑</button>
```

**按钮上下文**：位于流程模板列表的每一行操作列中，用户点击后进入编辑模式。

### 1.2 修改按钮点击事件处理

**文件位置**: `fronted/src/MultiRoleDialogSystem.tsx:628-637`

```tsx
const handleEdit = async (flow: FlowTemplate) => {
  try {
    // 从后端获取完整模板详情（包含步骤等配置）
    const fullFlow = await flowApi.getFlow(flow.id);
    setEditingFlow(fullFlow as Partial<FlowTemplate>);
  } catch (error) {
    console.error('获取流程模板详情失败:', error);
    alert((error as Error).message || '获取模板详情失败');
  }
}
```

**关键流程**：
1. 获取选中模板的基础信息（来自列表数据）
2. 调用 `flowApi.getFlow(flow.id)` 获取完整模板详情
3. 设置编辑状态 `setEditingFlow(fullFlow)`，触发编辑界面渲染

## 2. 前端数据获取阶段

### 2.1 API调用获取模板详情

**文件位置**: `fronted/src/api/flowApi.ts:99-101`

```typescript
/**
 * 获取流程模板详情
 */
async getFlow(id: number): Promise<FlowTemplate> {
  return apiClient.get<FlowTemplate>(`/api/flows/${id}`);
}
```

**HTTP请求详情**：
- **方法**: `GET`
- **URL**: `/api/flows/{id}`
- **响应格式**: `FlowTemplate` 对象

### 2.2 后端API响应 - GET /api/flows/{id}

**文件位置**: `backend/app/api/flows.py:126-145`

```python
def get(self, flow_id):
    """获取流程模板详情"""
    try:
        template = FlowTemplateService.get_template_by_id(flow_id, include_steps=True)
        if not template:
            return {
                'success': False,
                'error_code': 'NOT_FOUND',
                'message': '流程模板不存在'
            }, 404

        # 序列化结果，包含步骤信息
        flow_schema = FlowTemplateSchema()
        result = flow_schema.dump(template)
        current_app.logger.info("FlowDetail response data: %s", json.dumps(result, ensure_ascii=False))

        return {
            'success': True,
            'data': result
        }

    except Exception as e:
        current_app.logger.error(f"获取流程模板详情失败: {str(e)}")
        return {
            'success': False,
            'error_code': 'INTERNAL_ERROR',
            'message': '获取流程模板详情失败'
        }, 500
```

**响应数据结构**：
```json
{
  "success": true,
  "data": {
    "id": 1,
    "name": "教学流程模板",
    "topic": "数学教学",
    "type": "teaching",
    "description": "基础数学教学流程",
    "version": "2.0.0",
    "is_active": true,
    "termination_config": null,
    "created_at": "2024-01-01T10:00:00",
    "updated_at": "2024-01-01T10:00:00",
    "step_count": 3,
    "steps": [
      {
        "id": 1,
        "flow_template_id": 1,
        "order": 1,
        "speaker_role_ref": "Teacher",
        "target_role_ref": "Student",
        "task_type": "ask_question",
        "context_scope": ["Teacher", "Student"],
        "context_param": {
          "question_type": "open_ended"
        },
        "logic_config": {
          "timeout": 60,
          "retry_count": 2
        },
        "next_step_id": null,
        "description": "第一步：提问"
      },
      {
        "id": 2,
        "flow_template_id": 1,
        "order": 2,
        "speaker_role_ref": "Student",
        "target_role_ref": "Teacher",
        "task_type": "answer_question",
        "context_scope": "last_n_messages",
        "context_param": {
          "n": 3
        },
        "logic_config": {
          "require_keywords": ["answer", "solution"]
        },
        "next_step_id": null,
        "description": "第二步：回答"
      }
      // ... 更多步骤
    ]
  }
}
```

## 3. 前端编辑界面渲染

### 3.1 编辑界面组件结构

**文件位置**: `fronted/src/MultiRoleDialogSystem.tsx:888-897`

```tsx
<div className="space-y-6 animate-in slide-in-from-right duration-300">
  <div className="flex items-center gap-4 mb-6">
    <button onClick={onCancel} className="p-2 hover:bg-gray-100 rounded-full"><ArrowRight className="rotate-180" /></button>
    <div>
      <h1 className="text-2xl font-bold text-gray-900">{data.id ? '编辑模板' : '新建模板'}</h1>
    </div>
    <div className="ml-auto flex gap-3">
      <Button variant="secondary" onClick={onCancel}>取消</Button>
      <Button onClick={() => onSave({ ...data, steps })} icon={Save}>保存模板</Button>
    </div>
  </div>
  // ... 编辑表单内容
</div>
```

### 3.2 表单数据初始化

编辑界面会自动填充从后端获取的模板数据：
- **基本信息**: name, topic, type, description, version, is_active
- **步骤配置**: 包含所有步骤的完整配置信息
- **JSON字段**: termination_config, context_param, logic_config 自动反序列化

### 3.3 用户编辑操作

用户可以修改以下内容：
1. **基本信息**: 模板名称、议题、类型、描述、版本、状态
2. **步骤管理**: 添加、删除、修改步骤
3. **步骤配置**: 说话人、任务类型、上下文策略、逻辑配置

## 4. 保存修改数据流程

### 4.1 保存按钮点击事件

**文件位置**: `fronted/src/MultiRoleDialogSystem.tsx:747-758`

```tsx
let result;
if (isUpdate) {
  console.log(`更新现有模板，ID: ${flow.id}`);
  result = await flowApi.updateFlow(flow.id, {
    name: flow.name,
    topic: flow.topic,
    type: flow.type || 'teaching',
    description: flow.description,
    version: flow.version,
    is_active: flow.is_active,
    termination_config: flow.termination_config,
    steps: normalizedSteps
  });
} else {
  // 新建逻辑...
}
```

### 4.2 数据预处理

**关键步骤**：在发送到后端之前，前端会进行数据预处理：

```tsx
// normalize steps for API: strip frontend-only id and flow_template_id fields
const normalizedSteps = (flow.steps || []).map((step: any) => {
  const { id, flow_template_id, ...rest } = step;
  return rest;
});
```

**预处理效果**：
- 移除前端临时字段 `id` 和 `flow_template_id`
- 保留业务逻辑字段供后端处理
- JSON字段保持JavaScript对象/数组格式

### 4.3 前端API调用 - updateFlow

**文件位置**: `fronted/src/api/flowApi.ts:113-115`

```typescript
/**
 * 更新流程模板
 */
async updateFlow(id: number, flowData: Partial<FlowTemplateRequest>): Promise<FlowTemplate> {
  return apiClient.put<FlowTemplate>(`/api/flows/${id}`, flowData);
}
```

**HTTP请求详情**：
- **方法**: `PUT`
- **URL**: `/api/flows/{id}`
- **Content-Type**: `application/json`
- **请求体**: `Partial<FlowTemplateRequest>` 对象

### 4.4 请求数据格式

```json
{
  "name": "更新后的教学流程模板",
  "topic": "数学教学-进阶",
  "type": "teaching",
  "description": "更新后的教学流程描述",
  "version": "2.1.0",
  "is_active": false,
  "termination_config": {
    "max_duration": 3600,
    "max_steps": 20
  },
  "steps": [
    {
      "order": 1,
      "speaker_role_ref": "Teacher",
      "target_role_ref": "Student",
      "task_type": "ask_question",
      "context_scope": ["Teacher", "Student"],
      "context_param": {
        "question_type": "open_ended"
      },
      "logic_config": {
        "timeout": 60,
        "retry_count": 2
      },
      "description": "更新后的第一步：教师提问"
    },
    {
      "order": 2,
      "speaker_role_ref": "Student",
      "target_role_ref": "Teacher",
      "task_type": "answer_question",
      "context_scope": "last_n_messages",
      "context_param": {
        "n": 3
      },
      "logic_config": {
        "require_keywords": ["answer", "solution"]
      },
      "description": "更新后的第二步：学生回答"
    },
    {
      "order": 3,
      "speaker_role_ref": "Teacher",
      "task_type": "evaluate",
      "context_scope": ["Student"],
      "logic_config": {
        "evaluation_criteria": [
          "概念理解准确性",
          "公式应用正确性"
        ]
      },
      "description": "更新后的第三步：教师评估"
    }
  ]
}
```

## 5. 后端数据验证和处理

### 5.1 API层接收请求

**文件位置**: `backend/app/api/flows.py:155-199`

```python
def put(self, flow_id):
    """更新流程模板"""
    try:
        current_app.logger.info(f"=== 更新流程模板开始 (ID: {flow_id}) ===")

        json_data = request.get_json()
        current_app.logger.info(f"原始请求数据: {json.dumps(json_data, ensure_ascii=False, indent=2)}")

        if not json_data:
            current_app.logger.error("请求体为空")
            return {
                'success': False,
                'error_code': 'INVALID_REQUEST',
                'message': '请求体不能为空'
            }, 400

        # 数据验证
        update_schema = FlowTemplateUpdateSchema(context={'flow_template_id': flow_id})
        try:
            data = update_schema.load(json_data, partial=True)
            current_app.logger.info(f"Schema验证后数据: {json.dumps(data, ensure_ascii=False, indent=2)}")
        except Exception as e:
            current_app.logger.error(f"数据验证失败: {str(e)}")
            return {
                'success': False,
                'error_code': 'VALIDATION_ERROR',
                'message': '数据验证失败',
                'details': str(e)
            }, 400

        # 调用服务层更新模板
        current_app.logger.info(f"调用服务层更新模板: FlowTemplateService.update_template()")
        template = FlowTemplateService.update_template(flow_id, data)

        # 返回更新后的模板信息
        flow_schema = FlowTemplateSchema()
        result = flow_schema.dump(template)
        current_app.logger.info(f"服务层返回结果: {json.dumps(result, ensure_ascii=False, indent=2)}")

        current_app.logger.info("=== 更新流程模板完成 ===")
        return {
            'success': True,
            'data': result,
            'message': '流程模板更新成功'
        }

    except TemplateNotFoundError as e:
        return {
            'success': False,
            'error_code': 'NOT_FOUND',
            'message': str(e)
        }, 404

    # ... 其他异常处理
```

### 5.2 Schema验证层

**文件位置**: `backend/app/schemas/flow.py`

**FlowTemplateUpdateSchema** 关键特性：
- `partial=True`: 支持部分字段更新
- 严格的枚举值验证（task_type字段）
- JSON字段智能处理
- 字段可选性与前端完全一致

### 5.3 服务层业务逻辑

**文件位置**: `backend/app/services/flow_service.py:302-351`

```python
@staticmethod
def update_template(template_id: int, update_data: Dict[str, Any]) -> FlowTemplate:
    """
    更新模板

    Args:
        template_id: 模板ID
        update_data: 更新数据

    Returns:
        FlowTemplate: 更新后的模板对象
    """
    template = FlowTemplate.query.get(template_id)
    if not template:
        raise TemplateNotFoundError(f"模板ID {template_id} 不存在")

    try:
        # 检查名称冲突
        if 'name' in update_data and update_data['name'] != template.name:
            if FlowTemplate.query.filter_by(name=update_data['name']).first():
                raise DuplicateTemplateNameError(f"模板名称 '{update_data['name']}' 已存在")

        # 更新基本信息
        for field in ['name', 'type', 'description', 'version', 'is_active']:
            if field in update_data:
                setattr(template, field, update_data[field])

        # 更新结束条件配置
        if 'termination_config' in update_data:
            template.termination_config_dict = update_data['termination_config']

        # 更新步骤
        if 'steps' in update_data:
            # 删除现有步骤
            FlowStep.query.filter_by(flow_template_id=template_id).delete()
            # 创建新步骤
            FlowTemplateService._create_template_steps(template_id, update_data['steps'])

        template.updated_at = datetime.utcnow()
        db.session.commit()
        return template

    except Exception as e:
        db.session.rollback()
        if isinstance(e, FlowTemplateError):
            raise
        raise FlowTemplateError(f"更新模板失败: {str(e)}")
```

**关键业务逻辑**：
1. **存在性验证**: 检查模板是否存在
2. **名称冲突检查**: 防止重复模板名称
3. **字段选择性更新**: 只更新提供的字段
4. **步骤完整替换**: 删除旧步骤，创建新步骤
5. **事务管理**: 使用数据库事务确保数据一致性

## 6. 数据库层更新

### 6.1 数据库表结构

#### flow_templates 表
```sql
CREATE TABLE flow_templates (
    id INTEGER PRIMARY KEY,
    name VARCHAR(200) NOT NULL,
    topic VARCHAR(200) NULL,
    type VARCHAR(50) NOT NULL,
    description TEXT NULL,
    version VARCHAR(20) NULL,
    is_active BOOLEAN NULL DEFAULT NULL,
    termination_config TEXT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

#### flow_steps 表
```sql
CREATE TABLE flow_steps (
    id INTEGER PRIMARY KEY,
    flow_template_id INTEGER NOT NULL,
    order INTEGER NOT NULL,
    speaker_role_ref VARCHAR(50) NOT NULL,
    target_role_ref VARCHAR(50) NULL,
    task_type VARCHAR(50) NOT NULL,
    context_scope TEXT NULL,
    context_param TEXT NULL,
    logic_config TEXT NULL,
    next_step_id INTEGER NULL,
    description VARCHAR(500) NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (flow_template_id) REFERENCES flow_templates (id)
);
```

### 6.2 更新操作序列

#### 模板基本信息更新
```sql
UPDATE flow_templates
SET
    name = '更新后的教学流程模板',
    topic = '数学教学-进阶',
    type = 'teaching',
    description = '更新后的教学流程描述',
    version = '2.1.0',
    is_active = false,
    termination_config = '{"max_duration": 3600, "max_steps": 20}',
    updated_at = '2024-01-01 10:30:00'
WHERE id = 1;
```

#### 步骤更新操作（完整替换策略）
```sql
-- 1. 删除现有步骤
DELETE FROM flow_steps WHERE flow_template_id = 1;

-- 2. 创建新步骤
INSERT INTO flow_steps (
    flow_template_id, order, speaker_role_ref, target_role_ref, task_type,
    context_scope, context_param, logic_config, description
) VALUES
(
    1, 1, 'Teacher', NULL, 'ask_question',
    '["Teacher", "Student"]', '{"n": 5}', '{"timeout": 60}', '更新后的第一步'
),
(
    1, 2, 'Student', 'Teacher', 'answer_question',
    '"last_n_messages"', '{"n": 3}', '{"timeout": 30}', '回答步骤'
);
```

### 6.3 数据完整性保证

1. **事务原子性**: 模板更新和步骤更新在同一个事务中
2. **外键约束**: 步骤表引用模板表的完整性
3. **数据格式**: JSON字段在模型层智能处理
4. **版本控制**: updated_at字段记录修改时间

## 7. 响应返回和前端处理

### 7.1 后端响应格式

```json
{
  "success": true,
  "data": {
    "id": 1,
    "name": "更新后的教学流程模板",
    "topic": "数学教学-进阶",
    "type": "teaching",
    "description": "更新后的教学流程描述",
    "version": "2.1.0",
    "is_active": false,
    "termination_config": {
      "max_duration": 3600,
      "max_steps": 20
    },
    "created_at": "2024-01-01T10:00:00",
    "updated_at": "2024-01-01T10:30:00",
    "step_count": 3,
    "steps": [
      {
        "id": 4,
        "flow_template_id": 1,
        "order": 1,
        "speaker_role_ref": "Teacher",
        "target_role_ref": "Student",
        "task_type": "ask_question",
        "context_scope": ["Teacher", "Student"],
        "context_param": {
          "question_type": "open_ended"
        },
        "logic_config": {
          "timeout": 60,
          "retry_count": 2
        },
        "next_step_id": null,
        "description": "更新后的第一步：教师提问"
      },
      {
        "id": 5,
        "flow_template_id": 1,
        "order": 2,
        "speaker_role_ref": "Student",
        "target_role_ref": "Teacher",
        "task_type": "answer_question",
        "context_scope": "last_n_messages",
        "context_param": {
          "n": 3
        },
        "logic_config": {
          "require_keywords": ["answer", "solution"]
        },
        "next_step_id": null,
        "description": "更新后的第二步：学生回答"
      },
      {
        "id": 6,
        "flow_template_id": 1,
        "order": 3,
        "speaker_role_ref": "Teacher",
        "task_type": "evaluate",
        "context_scope": ["Student"],
        "logic_config": {
          "evaluation_criteria": [
            "概念理解准确性",
            "公式应用正确性"
          ]
        },
        "next_step_id": null,
        "description": "更新后的第三步：教师评估"
      }
    ]
  },
  "message": "流程模板更新成功"
}
```

### 7.2 前端响应处理

**文件位置**: `fronted/src/MultiRoleDialogSystem.tsx:760-780`

```tsx
try {
  let result;
  if (isUpdate) {
    // ... API调用
    console.log("模板更新成功:", result);
    alert("模板更新成功！");
    onCancel(); // 关闭编辑界面
    if (onFlowUpdated) {
      onFlowUpdated(result); // 通知父组件更新列表
    }
  }
} catch (error) {
  console.error("保存模板失败:", error);
  alert((error as Error).message || "保存失败");
}
```

## 8. 数据格式转换汇总

### 8.1 前端到后端转换

| 字段 | 前端格式 | 后端存储格式 | 转换处理 |
|------|----------|--------------|----------|
| `context_scope` | 字符串/数组 | JSON字符串 | 模型property自动序列化 |
| `context_param` | JavaScript对象 | JSON字符串 | 模型property自动序列化 |
| `logic_config` | JavaScript对象 | JSON字符串 | 模型property自动序列化 |
| `termination_config` | JavaScript对象 | JSON字符串 | 模型property自动序列化 |
| `task_type` | 枚举字符串 | VARCHAR(50) | 枚举值验证（严格匹配） |
| `is_active` | boolean | BOOLEAN | 直接映射 |

### 8.2 后端到前端转换

| 字段 | 数据库格式 | 后端处理 | 前端接收格式 |
|------|------------|----------|--------------|
| `context_scope` | JSON字符串 | 智能property反序列化 | 字符串/数组 |
| `context_param` | JSON字符串 | 智能property反序列化 | JavaScript对象 |
| `logic_config` | JSON字符串 | 智能property反序列化 | JavaScript对象 |
| `termination_config` | JSON字符串 | 智能property反序列化 | JavaScript对象 |
| `created_at` | DATETIME | ISO格式字符串 | ISO字符串 |
| `updated_at` | DATETIME | ISO格式字符串 | ISO字符串 |

### 8.3 字段预处理说明

**前端预处理**（发送到后端前）：
```tsx
// 移除前端临时字段
const normalizedSteps = (flow.steps || []).map((step: any) => {
  const { id, flow_template_id, ...rest } = step;  // 移除临时ID字段
  return rest;  // 保留业务逻辑字段
});
```

**关键字段说明**：
- **移除字段**: `id`, `flow_template_id` - 前端临时字段，后端重新生成
- **保留字段**: `order`, `speaker_role_ref`, `target_role_ref`, `task_type`, `context_scope`, `context_param`, `logic_config`, `description`
- **可选字段**: `target_role_ref`, `context_param`, `logic_config`, `description`

## 9. 错误处理机制

### 9.1 常见错误类型

1. **模板不存在**: HTTP 404, `NOT_FOUND`
2. **数据验证失败**: HTTP 400, `VALIDATION_ERROR`
3. **名称冲突**: HTTP 400, `DUPLICATE_NAME`
4. **权限问题**: HTTP 403, `PERMISSION_DENIED`
5. **系统错误**: HTTP 500, `INTERNAL_ERROR`

### 9.2 错误响应格式

```json
{
  "success": false,
  "error_code": "VALIDATION_ERROR",
  "message": "数据验证失败",
  "details": "steps.0.task_type: Must be one of: ask_question, answer_question, ..."
}
```

### 9.3 前端错误处理

```tsx
try {
  result = await flowApi.updateFlow(flow.id, updateData);
} catch (error) {
  console.error("保存模板失败:", error);
  alert((error as Error).message || "保存失败");
}
```

## 10. 性能优化和注意事项

### 10.1 性能优化

1. **步骤批量操作**: 删除和创建步骤使用批量SQL操作
2. **事务管理**: 确保数据一致性，避免中间状态
3. **JSON处理**: 模型层智能处理JSON字段，减少应用层转换
4. **懒加载**: 步骤数据按需加载

### 10.2 并发控制

1. **名称冲突检查**: 防止并发创建同名模板
2. **事务隔离**: 确保更新操作的原子性
3. **版本控制**: 通过updated_at追踪修改时间

### 10.3 数据一致性

1. **外键约束**: 确保步骤与模板的引用完整性
2. **级联操作**: 步骤删除与模板删除同步
3. **完整性验证**: 枚举值和字段格式严格验证

## 11. 安全考虑

### 11.1 输入验证

- 所有用户输入经过Schema验证
- 枚举值严格限制
- JSON字段格式验证

### 11.2 权限控制

- 模板创建和更新需要适当权限
- API层面的访问控制
- 数据级权限隔离

### 11.3 SQL注入防护

- 使用ORM参数化查询
- 避免直接SQL拼接
- 输入数据类型验证

## 12. 总结

### 12.1 数据流程特点

1. **读取-编辑-保存模式**: 先获取完整数据，编辑后完整保存
2. **步骤完整替换**: 更新时删除所有旧步骤，创建新步骤
3. **JSON字段智能处理**: 前后端透明转换，用户友好
4. **严格的数据验证**: Schema验证确保数据完整性

### 12.2 技术优势

- **数据一致性**: 事务机制确保更新操作的原子性
- **类型安全**: 前后端类型定义完全对齐
- **错误处理**: 完善的错误机制和用户反馈
- **性能优化**: 批量操作和懒加载提升性能

### 12.3 业务价值

- **用户体验**: 直观的编辑界面和实时反馈
- **数据安全**: 完整的验证和错误处理机制
- **系统稳定**: 事务控制和并发管理确保稳定性
- **开发效率**: 统一的数据格式和API接口

## 13. 数据结构一致性确认

### 13.1 与保存模板的数据结构对齐

经过更新，【修改模板】功能现在与【保存模板】功能保持完全一致的数据结构：

#### ✅ **前端发送格式一致**：
- **步骤字段**: 移除 `id`, `flow_template_id`，保留业务逻辑字段
- **task_type枚举**: 使用完整的10个标准枚举值
- **context_scope**: 支持字符串和数组格式
- **JSON字段**: `context_param`, `logic_config`, `termination_config` 格式统一

#### ✅ **后端处理一致**：
- **Schema验证**: 使用相同的 `FlowTemplateUpdateSchema` 验证规则
- **JSON处理**: 智能property自动序列化/反序列化
- **响应格式**: 统一的 `{ success: true, data: result, message: '...' }` 格式

#### ✅ **数据转换一致**：
- **预处理**: 相同的字段过滤和格式转换逻辑
- **存储格式**: 数据库字段和JSON处理完全一致
- **返回格式**: 步骤包含完整的 `id` 和 `flow_template_id` 信息

### 13.2 关键对齐点

| 功能 | 保存模板 | 修改模板 | 一致性状态 |
|------|----------|----------|------------|
| **请求数据格式** | ✅ 标准格式 | ✅ 标准格式 | ✅ 完全一致 |
| **响应数据格式** | ✅ 包装格式 | ✅ 包装格式 | ✅ 完全一致 |
| **步骤数据结构** | ✅ 完整字段 | ✅ 完整字段 | ✅ 完全一致 |
| **JSON字段处理** | ✅ 智能转换 | ✅ 智能转换 | ✅ 完全一致 |
| **枚举值验证** | ✅ 10个标准值 | ✅ 10个标准值 | ✅ 完全一致 |
| **错误处理** | ✅ 标准格式 | ✅ 标准格式 | ✅ 完全一致 |

### 13.3 统一的技术标准

1. **数据预处理标准**：移除前端临时字段，保留业务逻辑字段
2. **JSON处理标准**：模型层智能property自动序列化/反序列化
3. **枚举值标准**：使用完整的10个task_type标准枚举值
4. **响应格式标准**：统一的success/data/message包装格式
5. **错误处理标准**：标准化的错误码和错误消息

这套【修改模板】功能为Multi-Role Dialogue System项目提供了完整的模板编辑能力，支持复杂的对话流程配置，确保了数据的一致性和系统的稳定性。